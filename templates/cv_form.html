{% extends "base.html" %}

{% block title %}Create Your CV{% endblock %}

{% block content %}

<style>
/* --- Stepper Bar --- */
.stepper-container {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    position: relative;
}

.step-item {
    position: relative;
    text-align: center;
    width: 20%;
}

.step-circle {
    height: 36px;
    width: 36px;
    border-radius: 50%;
    margin: 0 auto;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #ddd;
    color: #333;
    font-weight: bold;
    transition: 0.3s;
}

.step-active .step-circle {
    background: #007bff;
    color: #fff;
}

.step-title {
    font-size: 14px;
    margin-top: 8px;
}

/* Progress bar line */
.stepper-line {
    position: absolute;
    top: 18px;
    left: 10%;
    width: 80%;
    height: 4px;
    background: #ddd;
    z-index: -1;
}

.progress-fill {
    height: 4px;
    background: #007bff;
    width: 0%;
    transition: width 0.4s ease;

}

/* Buttons */
.btn-primary {
    background: #007bff;
    border: none;
    padding: 10px 18px;
    border-radius: 6px;
    color: #fff;
}

.btn-secondary {
    background: #6c757d;
    border: none;
    padding: 10px 18px;
    border-radius: 6px;
    color: #fff;
}
</style>

<div class="container mt-4">

    <!-- Stepper UI -->
    <div class="stepper-container">
        <div class="stepper-line">
            <div class="progress-fill" data-width="{{ progress }}"></div>

        </div>

        {% for step_num, title in step_titles.items %}
            <div class="step-item {% if step_num == current_step %}step-active{% endif %}">
                <div class="step-circle">{{ step_num }}</div>
                <div class="step-title">{{ title }}</div>
            </div>
        {% endfor %}
    </div>

    <h2 class="mb-4">Step {{ current_step }}: {{ step_titles.current_step }}</h2>

    <!-- FORM -->
    <form method="POST" novalidate>
        {% csrf_token %}
        
        <!-- Render form fields -->
        {% for field in form %}
            <div class="mb-3">
                <label><strong>{{ field.label }}</strong></label>
                {{ field }}
                {% if field.errors %}
                    <div style="color:red; font-size:14px;">{{ field.errors|striptags }}</div>
                {% endif %}
            </div>
        {% endfor %}

        <div class="d-flex justify-content-between mt-4">
            {% if current_step > 1 %}
                <button name="prev_step" value="1" class="btn-secondary">← Previous</button>
            {% endif %}

            <button type="submit" class="btn-primary">
                {% if current_step == total_steps %}
                    Generate CV →
                {% else %}
                    Next →
                {% endif %}
            </button>
        </div>
    </form>

</div>

{% block extra_scripts %}
<script>
document.querySelectorAll('.progress-fill').forEach(el => {
    el.style.width = el.dataset.width + '%';
});
</script>

{% endblock %}
